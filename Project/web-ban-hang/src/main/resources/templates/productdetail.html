<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${product.name} + ' - Mộc E-commerce'">
      Chi tiết sản phẩm
    </title>
    <link
      rel="shortcut icon"
      th:href="@{/images/logo/favicon.svg}"
      type="image/x-icon"
    />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/product-detail.css}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Montserrat", sans-serif;
        font-weight: 300;
        line-height: 1.5;
        color: #333;
      }
      /* CSS cơ bản cho layout - tinh chỉnh trong product-detail.css */
      .product-detail-container {
        display: flex;
        flex-wrap: wrap;
        gap: 40px;
        padding: 40px 0;
        margin-top: 20px;
      }
      .product-image-section {
        flex: 1 1 450px; /* Điều chỉnh kích thước cơ sở */
      }
      .product-info-section {
        flex: 1 1 500px; /* Điều chỉnh kích thước cơ sở */
      }
      .product-main-image img {
        max-width: 100%;
        border-radius: 10px;
        border: 1px solid var(--cultured);
        display: block;
        margin: 0 auto; /* Căn giữa ảnh */
      }
      /* Thêm style cho thumbnail nếu có */
      .product-title {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--eerie-black);
        line-height: 1.3;
      }
      .product-sku {
        font-size: 0.85rem;
        color: var(--sonic-silver);
        margin-bottom: 20px;
      }
      .product-price {
        font-size: 1.8rem;
        color: var(--salmon-pink);
        font-weight: 700;
        margin-bottom: 25px;
        display: flex;
        align-items: baseline;
        gap: 15px;
      }
      .product-price .original {
        font-size: 1.1rem;
        color: var(--sonic-silver);
        text-decoration: line-through;
        font-weight: 400;
      }
      .quantity-selector {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 30px;
      }
      .quantity-selector label {
        font-weight: 600;
        font-size: 0.95rem;
        color: var(--eerie-black);
        margin-right: 5px;
      }
      .quantity-controls {
        display: flex;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
      }
      .quantity-selector input[type="number"] {
        width: 60px;
        text-align: center;
        padding: 10px 5px;
        border: none;
        font-size: 1rem;
        font-weight: 500;
        appearance: textfield;
        -moz-appearance: textfield;
      }
      .quantity-selector input[type="number"]::-webkit-inner-spin-button,
      .quantity-selector input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      .quantity-btn {
        background: #f5f5f5;
        border: none;
        cursor: pointer;
        width: 35px;
        height: 40px; /* Điều chỉnh chiều cao */
        font-size: 1.4rem;
        line-height: 40px;
        color: #555;
        transition: background 0.2s ease;
      }
      .quantity-btn:hover {
        background: #e0e0e0;
      }
      .quantity-btn.minus {
        border-right: 1px solid #ccc;
      }
      .quantity-btn.plus {
        border-left: 1px solid #ccc;
      }
      .stock-info {
        margin-left: 15px;
        font-size: 0.9rem;
        color: var(--sonic-silver);
      }
      .action-buttons button {
        padding: 12px 25px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        border-radius: 5px;
        border: none;
        margin-right: 15px;
        text-transform: uppercase;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      .action-buttons button:active {
        transform: scale(0.98);
      }
      .btn-add-to-cart {
        background-color: var(--cultured);
        color: var(--eerie-black);
        border: 1px solid var(--salmon-pink);
      }
      .btn-add-to-cart:hover {
        background-color: hsla(34, 35%, 70%, 0.2);
      }
      .btn-buy-now {
        background-color: var(--salmon-pink);
        color: white;
      }
      .btn-buy-now:hover {
        background-color: var(--eerie-black);
      }
      .product-description {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid var(--cultured);
      }
      .product-description h3 {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--eerie-black);
        margin-bottom: 15px;
      }
      .product-description p {
        color: var(--sonic-silver);
        line-height: 1.8;
        font-size: 0.95rem;
        white-space: pre-wrap; /* Giữ nguyên định dạng xuống dòng nếu có */
      }
      .breadcrumbs {
        padding-top: 25px;
        padding-bottom: 10px;
        font-size: 0.9rem;
      } /* Điều chỉnh breadcrumbs */
      /* Responsive */
      @media (max-width: 992px) {
        .product-detail-container {
          gap: 30px;
        }
        .product-image-section {
          flex-basis: 400px;
        }
      }
      @media (max-width: 768px) {
        .product-detail-container {
          flex-direction: column;
          padding: 20px 0;
        }
        .product-image-section,
        .product-info-section {
          flex-basis: auto;
        }
        .product-title {
          font-size: 1.6rem;
        }
        .product-price {
          font-size: 1.5rem;
        }
        .action-buttons button {
          width: calc(50% - 8px);
          margin-bottom: 10px;
        }
        .action-buttons {
          display: flex;
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <div th:replace="~{fragment/header :: header}"></div>

    <main>
      <div class="container">
        <div class="breadcrumbs">
          <a th:href="@{/}">Trang chủ</a>
          <ion-icon name="chevron-forward-outline"></ion-icon>
          <a
            th:if="${product.category != null}"
            href="#"
            th:text="${product.category}"
            >Danh mục</a
          >
          <ion-icon
            name="chevron-forward-outline"
            th:if="${product.category != null}"
          ></ion-icon>
          <span th:text="${product.name}">Tên sản phẩm</span>
        </div>

        <div class="product-detail-container">
          <div class="product-image-section">
            <div class="product-main-image">
              <img
                th:src="@{${product.imageUrl ?: '/images/placeholder.png'}}"
                th:alt="${product.name}"
              />
            </div>
          </div>

          <div class="product-info-section">
            <h1 class="product-title" th:text="${product.name}">
              Tên Sản phẩm
            </h1>

            <p class="product-sku" th:text="'Mã sản phẩm: SP' + ${product.id}">
              Mã sản phẩm: SP123
            </p>

            <div class="product-price">
              <span
                th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"
                >Giá bán</span
              >
              <span
                class="original"
                th:if="${product.originalPrice != null and product.originalPrice > product.price}"
                th:text="${#numbers.formatDecimal(product.originalPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'"
                >Giá gốc</span
              >
            </div>

            <div class="quantity-selector">
              <label for="quantity">Số lượng:</label>
              <div class="quantity-controls">
                <button
                  type="button"
                  class="quantity-btn minus"
                  onclick="adjustQty(-1)"
                >
                  -
                </button>
                <input
                  type="number"
                  id="quantity"
                  name="quantity"
                  value="1"
                  min="1"
                  th:max="${product.stock > 0 ? product.stock : 1}"
                  th:attr="data-max=${product.stock > 0 ? product.stock : 1}"
                />
                <button
                  type="button"
                  class="quantity-btn plus"
                  onclick="adjustQty(1)"
                >
                  +
                </button>
              </div>
              <span
                class="stock-info"
                th:text="'(Còn ' + ${product.stock > 0 ? product.stock : 0} + ' sản phẩm)'"
              ></span>
            </div>

            <div class="action-buttons">
              <button type="button" class="btn-add-to-cart">
                <ion-icon
                  name="cart-outline"
                  style="margin-right: 5px; vertical-align: middle"
                ></ion-icon>
                Thêm vào giỏ hàng
              </button>
              <button type="button" class="btn-buy-now">Mua ngay</button>
            </div>

            <div class="product-description">
              <h3>Mô tả sản phẩm</h3>
              <p
                th:utext="${product.description != null and not #strings.isEmpty(product.description) ? #strings.replace(product.description, T(System).getProperty('line.separator'), '&lt;br/&gt;') : 'Chưa có mô tả cho sản phẩm này.'}"
              >
                Mô tả chi tiết về sản phẩm...
              </p>
            </div>

            <div
              class="extra-info"
              style="
                margin-top: 30px;
                font-size: 0.9rem;
                color: var(--sonic-silver);
              "
            >
              <p>
                <ion-icon
                  name="paper-plane-outline"
                  style="vertical-align: middle; margin-right: 5px"
                ></ion-icon>
                Giao hàng toàn quốc.
              </p>
              <p>
                <ion-icon
                  name="shield-checkmark-outline"
                  style="vertical-align: middle; margin-right: 5px"
                ></ion-icon>
                Kiểm tra sản phẩm khi giao đến.
              </p>
              <p>
                <ion-icon
                  name="return-up-back-outline"
                  style="vertical-align: middle; margin-right: 5px"
                ></ion-icon>
                Đổi size/mẫu trong vòng 14 ngày.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div th:replace="~{fragment/footer :: footer}"></div>

    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script th:src="@{/js/script.js}"></script>

    <script>
      function adjustQty(amount) {
        const qtyInput = document.getElementById("quantity");
        const maxQty = parseInt(qtyInput.getAttribute("data-max")) || 1; // Lấy max từ attribute data-max
        let currentQty = parseInt(qtyInput.value);
        let newQty = currentQty + amount;

        // Đảm bảo số lượng không nhỏ hơn 1 và không lớn hơn tồn kho
        if (newQty < 1) {
          newQty = 1;
        } else if (newQty > maxQty) {
          newQty = maxQty;
          // Bạn có thể thêm thông báo ở đây nếu muốn
          // alert('Số lượng sản phẩm trong kho không đủ!');
        }
        qtyInput.value = newQty;
      }

      // Xử lý khi người dùng nhập trực tiếp vào ô số lượng
      const qtyInput = document.getElementById("quantity");
      qtyInput.addEventListener("change", function () {
        const maxQty = parseInt(this.getAttribute("data-max")) || 1;
        let value = parseInt(this.value);
        if (isNaN(value) || value < 1) {
          this.value = 1; // Nếu nhập không hợp lệ hoặc nhỏ hơn 1, đặt lại là 1
        } else if (value > maxQty) {
          this.value = maxQty; // Nếu nhập lớn hơn tồn kho, đặt lại là max
        }
      });
    </script>
  </body>
</html>
